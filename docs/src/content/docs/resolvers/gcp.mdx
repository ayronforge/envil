---
title: GCP Secret Manager
description: Resolve environment variables from Google Cloud Secret Manager.
order: 11
---

import TypeTable from "@/components/docs/TypeTable.astro";
import Callout from "@/components/docs/Callout.astro";
import Tabs from "@/components/docs/Tabs.astro";

## Installation

Install the GCP SDK peer dependency:

<Tabs items={["npm", "pnpm", "bun", "yarn"]} persist="pkg-manager">
  <div>
    ```bash
    npm install @google-cloud/secret-manager
    ```
  </div>
  <div>
    ```bash
    pnpm add @google-cloud/secret-manager
    ```
  </div>
  <div>
    ```bash
    bun add @google-cloud/secret-manager
    ```
  </div>
  <div>
    ```bash
    yarn add @google-cloud/secret-manager
    ```
  </div>
</Tabs>

## Basic usage

```ts
import { createEnv, requiredString } from "@ayronforge/better-env"
import { fromGcpSecrets } from "@ayronforge/better-env/gcp"
import { Effect } from "effect"

const envEffect = createEnv({
  server: {
    DATABASE_URL: requiredString,
    API_KEY: requiredString,
  },
  resolvers: [
    fromGcpSecrets({
      secrets: {
        DATABASE_URL: "database-url",
        API_KEY: "api-key",
      },
      projectId: "my-gcp-project",
    }),
  ],
})

const env = await Effect.runPromise(envEffect)
```

## Options

<TypeTable rows={[
  { name: "secrets", type: "Record<string, string>", required: true, description: "Map of env var names to GCP secret names (or full resource paths)." },
  { name: "client", type: "GcpSecretsClient", description: "Custom client instance. If omitted, the SDK is lazily imported and initialized." },
  { name: "projectId", type: "string", description: "GCP project ID. Required when using short secret names." },
  { name: "version", type: "string", default: '"latest"', description: "Secret version to access." },
]} />

## Full resource names

You can use either short secret names or full GCP resource paths:

```ts
fromGcpSecrets({
  secrets: {
    // Short name — requires projectId
    DATABASE_URL: "database-url",

    // Full resource path — projectId not needed
    API_KEY: "projects/my-project/secrets/api-key/versions/latest",
  },
  projectId: "my-gcp-project",
})
```

Short names are expanded to: `projects/{projectId}/secrets/{name}/versions/{version}`

## Custom version

Access a specific version of a secret instead of `latest`:

```ts
fromGcpSecrets({
  secrets: { API_KEY: "api-key" },
  projectId: "my-project",
  version: "3",  // Access version 3 specifically
})
```

## Custom client

Provide your own client for testing:

```ts
fromGcpSecrets({
  secrets: { API_KEY: "test-secret" },
  client: {
    accessSecretVersion: async (request) => {
      return {
        payload: { data: "mock-api-key" },
      }
    },
  },
})
```

<Callout type="note">
  The GCP resolver handles both `Uint8Array` and `string` payloads automatically. If the secret data is a `Uint8Array`, it's decoded with `TextDecoder`.
</Callout>
